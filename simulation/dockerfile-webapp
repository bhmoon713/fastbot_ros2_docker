FROM osrf/ros:humble-desktop
ENV DEBIAN_FRONTEND=noninteractive

# Change the default shell to Bash
SHELL [ "/bin/bash" , "-c" ]

# Installing nginx
RUN apt-get update \
    && apt-get install -y nginx \
    && apt-get install -y python3-pip  \
    python3-colcon-common-extensions \
    python3-setuptools \
    python3-pytest \
    python3-numpy \
    ros-humble-web-video-server \ 
    ros-humble-ament-cmake-mypy \ 
    && rm -rf /var/lib/apt/lists/*

# Install Python deps for rosbridge_suite
RUN pip install pymongo
RUN pip install tornado
RUN pip install pyquaternion

# These paths are relative to the BUILD CONTEXT (we'll set it to ~/ros2_ws/src)
COPY fastbot_ros2_docker/simulation/entrypoint.sh /entrypoint.sh
COPY fastbot_webapp/ /var/www/html/

WORKDIR /ros2_ws/src
RUN git clone -b humble https://github.com/RobotWebTools/rosbridge_suite.git

 # Build the Colcon workspace and ensure it's sourced
RUN source /opt/ros/humble/setup.bash \
 && cd /ros2_ws \
 && colcon build
RUN echo "source /ros2_ws/install/setup.bash" >> ~/.bashrc

ENTRYPOINT ["/bin/bash"]
CMD ["/entrypoint.sh"]